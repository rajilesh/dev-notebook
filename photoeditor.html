<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Photoshop - Pro Edition</title>
    <style>
        :root {
            --bg-dark: #1e1e1e;
            --panel-bg: #252526;
            --text-main: #d4d4d4;
            --accent: #007fd4;
            --accent-hover: #0060a0;
            --border: #3e3e42;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            height: 50px;
            background: #333333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            justify-content: space-between;
        }

        h1 { font-size: 16px; font-weight: 500; margin: 0; color: #fff; }

        .header-controls button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }
        .header-controls button:hover { background: var(--accent-hover); }
        .header-controls input[type="file"] { display: none; }

        /* --- Main Layout --- */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* --- Canvas Area --- */
        .canvas-container {
            flex: 1;
            background-color: #111;
            background-image: 
                linear-gradient(45deg, #1a1a1a 25%, transparent 25%), 
                linear-gradient(-45deg, #1a1a1a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #1a1a1a 75%), 
                linear-gradient(-45deg, transparent 75%, #1a1a1a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            position: relative;
        }

        canvas {
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        /* --- Sidebar Controls --- */
        .sidebar {
            width: 280px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .tool-group {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .tool-group h3 {
            margin: 0 0 15px 0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
        }

        .control-row {
            margin-bottom: 15px;
        }

        .control-row label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: #444;
            border-radius: 2px;
            appearance: none;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn-tool {
            background: #3e3e42;
            border: none;
            color: white;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-tool:hover { background: #505055; }
        .btn-tool.active { background: var(--accent); }

        .no-image-msg {
            position: absolute;
            color: #666;
            font-size: 14px;
            pointer-events: none;
        }
    </style>
</head>
<body>

<header>
    <h1>Mini Photoshop <span style="font-size: 10px; opacity: 0.7;">BETA</span></h1>
    <div class="header-controls">
        <button onclick="document.getElementById('fileInput').click()">Open Image</button>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="downloadImage()">Save Image</button>
    </div>
</header>

<div class="workspace">
    <div class="canvas-container">
        <span class="no-image-msg" id="placeholderMsg">No image loaded. Open an image to start editing.</span>
        <canvas id="editorCanvas"></canvas>
    </div>

    <aside class="sidebar">
        <div class="tool-group">
            <h3>Adjustments</h3>
            
            <div class="control-row">
                <label>Brightness <span id="val-brightness">100%</span></label>
                <input type="range" id="brightness" min="0" max="200" value="100">
            </div>

            <div class="control-row">
                <label>Contrast <span id="val-contrast">100%</span></label>
                <input type="range" id="contrast" min="0" max="200" value="100">
            </div>

            <div class="control-row">
                <label>Saturation <span id="val-saturate">100%</span></label>
                <input type="range" id="saturate" min="0" max="200" value="100">
            </div>

            <div class="control-row">
                <label>Blur <span id="val-blur">0px</span></label>
                <input type="range" id="blur" min="0" max="10" value="0" step="0.1">
            </div>
            
            <div class="btn-grid">
                <button class="btn-tool" onclick="resetFilters()">Reset All</button>
            </div>
        </div>

        <div class="tool-group">
            <h3>Quick Filters</h3>
            <div class="btn-grid">
                <button class="btn-tool" onclick="applyPreset('grayscale')">Grayscale</button>
                <button class="btn-tool" onclick="applyPreset('sepia')">Sepia</button>
                <button class="btn-tool" onclick="applyPreset('invert')">Invert</button>
                <button class="btn-tool" onclick="applyPreset('vintage')">Vintage</button>
            </div>
        </div>

        <div class="tool-group">
            <h3>Transform</h3>
            <div class="btn-grid">
                <button class="btn-tool" onclick="rotateImage(-90)">↺ Rotate Left</button>
                <button class="btn-tool" onclick="rotateImage(90)">↻ Rotate Right</button>
                <button class="btn-tool" onclick="flipImage('h')">↔ Flip H</button>
                <button class="btn-tool" onclick="flipImage('v')">↕ Flip V</button>
            </div>
        </div>
    </aside>
</div>

<script>
    /**
     * Core Logic:
     * 1. Store the original image source.
     * 2. Store current filter state (brightness, contrast, etc.).
     * 3. Store current transform state (rotation, flip).
     * 4. On any change, clear canvas -> apply transforms -> apply filters -> draw image.
     */

    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('editorCanvas');
    const ctx = canvas.getContext('2d');
    const placeholderMsg = document.getElementById('placeholderMsg');

    // State
    let originalImage = null;
    let fileName = 'edited-image.png';
    
    let settings = {
        brightness: 100,
        contrast: 100,
        saturate: 100,
        blur: 0,
        rotate: 0,
        flipH: 1,
        flipV: 1,
        grayscale: 0,
        sepia: 0,
        invert: 0
    };

    // --- Event Listeners for Sliders ---
    const sliders = ['brightness', 'contrast', 'saturate', 'blur'];
    sliders.forEach(id => {
        const slider = document.getElementById(id);
        const label = document.getElementById(`val-${id}`);
        
        slider.addEventListener('input', (e) => {
            settings[id] = parseFloat(e.target.value);
            label.innerText = id === 'blur' ? `${settings[id]}px` : `${settings[id]}%`;
            render();
        });
    });

    // --- File Loading ---
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        fileName = file.name;
        const reader = new FileReader();
        
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                originalImage = img;
                // Reset settings on new load
                resetFilters(); 
                // Fit canvas to image
                canvas.width = img.width;
                canvas.height = img.height;
                placeholderMsg.style.display = 'none';
                render();
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    // --- Core Rendering Engine ---
    function render() {
        if (!originalImage) return;

        // Clear canvas
        canvas.width = originalImage.width; // Resets context state heavily
        canvas.height = originalImage.height;
        
        const w = canvas.width;
        const h = canvas.height;

        ctx.save();

        // 1. Handle Transforms (Translate to center, rotate/scale, translate back)
        ctx.translate(w / 2, h / 2);
        ctx.rotate((settings.rotate * Math.PI) / 180);
        ctx.scale(settings.flipH, settings.flipV);
        
        // Adjust for rotation dimensions logic if we were resizing canvas (skipped for simplicity here, 
        // we draw overflow if 90deg on non-square, but keeping canvas source size ensures pixel data integrity)
        // For a true crop-to-fit rotation, we'd need to resize canvas dimensions here.
        
        ctx.translate(-w / 2, -h / 2);

        // 2. Apply Filters
        // We compose the filter string for the Context API
        let filterString = `
            brightness(${settings.brightness}%) 
            contrast(${settings.contrast}%) 
            saturate(${settings.saturate}%) 
            blur(${settings.blur}px)
            grayscale(${settings.grayscale}%)
            sepia(${settings.sepia}%)
            invert(${settings.invert}%)
        `;
        ctx.filter = filterString;

        // 3. Draw Image
        ctx.drawImage(originalImage, 0, 0);

        ctx.restore();
    }

    // --- Actions ---
    function resetFilters() {
        settings = {
            brightness: 100, contrast: 100, saturate: 100, blur: 0,
            rotate: 0, flipH: 1, flipV: 1,
            grayscale: 0, sepia: 0, invert: 0
        };
        
        // Update UI sliders
        sliders.forEach(id => {
            document.getElementById(id).value = settings[id];
            document.getElementById(`val-${id}`).innerText = id === 'blur' ? '0px' : '100%';
        });
        
        render();
    }

    function applyPreset(type) {
        // Reset base colors first
        settings.grayscale = 0;
        settings.sepia = 0;
        settings.invert = 0;

        switch(type) {
            case 'grayscale': settings.grayscale = 100; break;
            case 'sepia': settings.sepia = 100; break;
            case 'invert': settings.invert = 100; break;
            case 'vintage':
                settings.sepia = 50;
                settings.contrast = 120;
                settings.brightness = 90;
                settings.saturate = 80;
                break;
        }
        
        // Update UI for complex presets
        document.getElementById('contrast').value = settings.contrast;
        document.getElementById('brightness').value = settings.brightness;
        document.getElementById('saturate').value = settings.saturate;
        
        render();
    }

    function rotateImage(deg) {
        settings.rotate = (settings.rotate + deg) % 360;
        render();
    }

    function flipImage(dir) {
        if (dir === 'h') settings.flipH *= -1;
        if (dir === 'v') settings.flipV *= -1;
        render();
    }

    function downloadImage() {
        if (!originalImage) return;
        
        // Create a temporary link
        const link = document.createElement('a');
        link.download = 'edited_' + fileName;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    }
</script>

</body>
</html>